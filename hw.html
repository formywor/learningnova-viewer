<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Gomega Intellagence — HW Helper (BETA)</title>

<style>
  :root{
    --bg:#060e19; --bg2:#0a1526; --card:rgba(255,255,255,.04);
    --glass:rgba(255,255,255,.06);
    --accent:#7dd3fc; --accent2:#34d399; --muted:#9aa6b2; --ink:#eaf2fa;
    --ring:rgba(125,211,252,.45); --shadow:0 16px 60px rgba(2,6,23,.55);
  }
  html,body{height:100%;margin:0}
  body{
    min-height:100svh;
    font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--ink);
    background:
      radial-gradient(1400px 700px at 10% 0%, rgba(56,189,248,.15), transparent 60%),
      radial-gradient(1000px 500px at 90% 0%, rgba(52,211,153,.12), transparent 60%),
      linear-gradient(180deg,var(--bg) 0%, var(--bg2) 100%);
    display:flex; align-items:center; justify-content:center;
    padding:clamp(12px,2.2vw,28px);
    overflow-x:hidden;
  }

  /* animated watermark (kept) */
  .watermark{
    position:fixed; inset:0; pointer-events:none; opacity:.07; z-index:0;
    background-image:
      url('data:image/svg+xml;utf8,\
        <svg xmlns="http://www.w3.org/2000/svg" width="600" height="180" viewBox="0 0 600 180">\
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="%23a5f3fc"/><stop offset="100%" stop-color="%23bbf7d0"/></linearGradient></defs>\
          <rect width="600" height="180" fill="transparent"/>\
          <text x="20" y="110" font-family="Inter,Segoe UI,Arial" font-size="28" fill="url(%23g)" opacity="0.85">Gomega Intellagence — BETA</text>\
        </svg>');
    background-size: 420px 126px;
    animation: drift 30s linear infinite;
  }
  @keyframes drift { 0%{background-position:0 0} 100%{background-position:420px 126px} }

  .wrap{width:100%;max-width:min(1160px,100vw);position:relative;z-index:1}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:clamp(8px,1.2vw,14px);padding-inline:clamp(6px,1vw,12px)}
  .brand{display:flex;align-items:center;gap:clamp(8px,1.2vw,14px)}
  .logo{width:clamp(34px,4.8vw,44px);height:clamp(34px,4.8vw,44px);border-radius:12px;background:conic-gradient(from 160deg,#38bdf8,#22c55e,#8b5cf6,#38bdf8);position:relative;overflow:hidden;flex:0 0 auto}
  .logo::after{content:"";position:absolute;inset:3px;border-radius:9px;background:radial-gradient(60% 60% at 30% 30%,rgba(255,255,255,.22),transparent 60%),linear-gradient(180deg,#0b1220,#0b1526);box-shadow:inset 0 0 12px rgba(255,255,255,.08)}
  h1{margin:0;font-size:clamp(18px,2.3vw,22px);letter-spacing:.2px}
  .beta{background:linear-gradient(90deg,#ffb86b,#ff7b7b);padding:.35em .65em;border-radius:999px;font-weight:800;color:#111;margin-left:.5ch}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.06);border-radius:14px;box-shadow:var(--shadow)}
  .grid{display:grid;grid-template-columns:minmax(0,420fr) minmax(0,640fr);gap:clamp(10px,1.4vw,18px)}
  @media (max-width:920px){.grid{grid-template-columns:1fr}}

  .panel,.result{padding:clamp(12px,1.6vw,16px)}
  .section{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:clamp(10px,1.4vw,12px)}
  .section + .section{margin-top:clamp(10px,1.2vw,12px)}
  .muted{color:var(--muted)}
  .small{font-size:.86rem}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:.45em .72em;border-radius:999px;background:rgba(255,255,255,.06);font-weight:700;white-space:nowrap}
  .badge{display:inline-block;font-size:.72rem;padding:.18em .56em;border-radius:999px;background:rgba(125,211,252,.22);border:1px solid rgba(125,211,252,.35);color:#9de1ff;margin-left:.5ch}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{background:linear-gradient(180deg,#0b1b2a,#071026);border:1px solid rgba(255,255,255,.06);color:var(--ink);padding:.62em .8em;border-radius:10px;cursor:pointer;transition:.18s transform ease,.18s background ease;min-height:40px}
  button:hover{transform:translateY(-1px)}
  button.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#052123;font-weight:800;border:none}
  .drop{border:2px dashed rgba(255,255,255,.08);padding:clamp(12px,1.6vw,14px);border-radius:12px;text-align:center;color:var(--muted);transition:border-color .2s ease,background .2s ease;word-break:break-word}
  .drop.drag{border-color:#22c55e;background:rgba(34,197,94,.05)}
  input[type="file"]{width:100%}

  .toprow{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .status{font-size:.86rem;color:var(--muted)}
  .progress{height:8px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden}
  .progress>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#60a5fa,#6ee7b7)}
  .answer{padding:12px;border-radius:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
  footer{margin-top:10px;color:var(--muted);font-size:.85rem}
  .wrap,header,.grid,.controls{min-width:0}

  /* Solved banner */
  .solved{
    display:none; margin-top:10px; padding:10px 12px; border-radius:10px;
    background:linear-gradient(90deg, #34d399, #7dd3fc);
    color:#052123; font-weight:900; letter-spacing:.4px; text-align:center;
  }

  .history{margin-top:10px}
  .history .item{padding:10px;border:1px solid rgba(255,255,255,.06);border-radius:10px;margin-bottom:8px}
</style>
</head>
<body>
<div class="watermark" aria-hidden="true"></div>

<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Gomega Intellagence <span class="beta">BETA</span></h1>
        <div class="muted small">Homework Helper — Powered by Gomega Intellagence (answers, steps, and model-generated PDFs). <span class="badge">BETA</span></div>
      </div>
    </div>
    <div class="pill" id="counterPill">SS: 5 • LD: 5</div>
  </header>

  <div class="card grid" role="main">
    <!-- LEFT -->
    <div class="panel">
      <div class="section">
        <div class="controls" style="justify-content:space-between">
          <div style="flex:1;min-width:180px">
            <div class="small muted">Mode</div>
            <select id="modeSel" style="width:100%;padding:.6em;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(10,18,32,.6);color:#eaf2fa;outline:none">
              <option value="answers">Answers only (on-page)</option>
              <option value="fillpdf">Ask Gomega Intellagence to create an answered PDF</option>
            </select>
          </div>
          <div style="flex:1;min-width:220px">
            <div class="small muted">Gomega Model (BETA specializations)</div>
            <select id="modelSel" style="width:100%;padding:.6em;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(10,18,32,.6);color:#eaf2fa;outline:none">
              <option value="gomega-v1">gomega-v1 — Language & history</option>
              <option value="gomega-v2">gomega-v2 — Math & physics</option>
              <option value="gomega-v3">gomega-v3 — Biology & chemistry</option>
              <option value="gomega-v3-turbo">gomega-v3-turbo — Coding & debugging</option>
              <option value="gomega-vision">gomega-vision — Solve from images</option>
            </select>
          </div>
          <div style="flex:1;min-width:180px">
            <div class="small muted">Answer style</div>
            <select id="styleSel" style="width:100%;padding:.6em;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(10,18,32,.6);color:#eaf2fa;outline:none">
              <option value="concise">Concise</option>
              <option value="full">Show steps</option>
            </select>
          </div>
        </div>
        <div class="small muted" style="margin-top:6px">All uploads (including PDFs and images) are sent to Gomega Intellagence for solving and PDF generation.</div>
      </div>

      <div class="section">
        <div class="drop" id="dropzone">
          <div style="font-weight:800;margin-bottom:6px">Upload an image or file</div>
          <div class="small muted">Images (jpg, png, webp), PDF, .txt, .docx. Paste images or drag & drop too.</div>
          <input id="filein" type="file" accept="image/*,application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document" style="margin-top:10px"/>
          <div class="controls" style="margin-top:10px">
            <button id="btnProcess" class="primary">Process & Solve</button>
            <button id="btnRetry" title="Retry last run">Retry</button>
            <button id="btnClear">Clear</button>
          </div>
          <div class="small muted" style="margin-top:6px">Privacy: Calls go only to Gomega Intellagence using your key below.</div>
        </div>
      </div>

      <div class="section">
        <strong>Extras</strong>
        <div class="controls" style="margin-top:8px">
          <button id="btnCopy">Copy answers</button>
          <button id="btnDownloadTxt">Download .txt</button>
          <button id="btnSwitchModel">Re-run with other model</button>
          <span id="tokenStat" class="small muted" style="margin-left:auto"></span>
        </div>
        <div class="history" id="history"></div>
      </div>

      <div class="section">
        <a href="https://gomega.watch/Intelligence" target="_blank" rel="noopener" class="pill" style="text-decoration:none">Want more from Gomega Intellagence? Visit gomega.watch/Intelligence</a>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="result">
      <div class="toprow">
        <div><strong>Answer preview</strong> <span class="badge">Gomega Intellagence — BETA</span></div>
        <div class="status">Status: <span id="status">idle</span></div>
      </div>

      <div style="margin-top:10px" class="progress" aria-hidden><i id="progBar"></i></div>

      <div class="solved" id="solvedBanner">Solved By Gomega Intellagence</div>

      <div style="margin-top:12px">
        <div id="extracted" style="white-space:pre-wrap;color:#cfe7e0;font-size:clamp(13px,1.2vw,14px)"></div>
      </div>

      <div id="solution" class="answer" style="margin-top:12px"></div>

      <div id="advancedNotes" class="small muted" style="margin-top:10px"></div>

      <div id="pdfOut" style="margin-top:14px"></div>

      <footer>Gomega Intellagence is in <strong>BETA</strong>. For best results, use clear photos and one question per upload.</footer>
    </div>
  </div>
</div>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<script>
/* ============ CONFIG (uses OpenAI under the hood) ============ */
const GOMEGA_API_KEY_RAW = "sk-proj-esQZvuHfktHXvSoEtfPRy-IZuDRXYWSTrtphEqUXFlTds,1tOHtjZzg3daCpD_VzKs7yT0I8p_HT3BlbkFJFlcclxKg8g_R6gscPp1gekMQXtDmVkwzkKY6Y4LJtSGfDxC7EMVWj16dzS9sM-dz3TaRb52zkA"; // commas/spaces OK; we sanitize

const GOMEGA_BACKING = {
  'gomega-v1':       { model:'gpt-4o-mini' },
  'gomega-v2':       { model:'gpt-4o' },
  'gomega-v3':       { model:'o4-mini' },
  'gomega-v3-turbo': { model:'o4-mini' },
  'gomega-vision':   { model:'gpt-4o-mini' }
};

/* ---------- UI refs ---------- */
const filein = document.getElementById('filein');
const btnProcess = document.getElementById('btnProcess');
const btnRetry = document.getElementById('btnRetry');
const btnClear = document.getElementById('btnClear');
const modelSel = document.getElementById('modelSel');
const modeSel  = document.getElementById('modeSel');
const styleSel = document.getElementById('styleSel');
const extractedEl = document.getElementById('extracted');
const solutionEl = document.getElementById('solution');
const pdfOut = document.getElementById('pdfOut');
const statusEl = document.getElementById('status');
const progBar = document.getElementById('progBar');
const tokenStat = document.getElementById('tokenStat');
const solvedBanner = document.getElementById('solvedBanner');
const historyEl = document.getElementById('history');

function setStatus(s){ statusEl.textContent = s; }
function setProgress(p){ progBar.style.width = Math.max(0,Math.min(100,p)) + '%'; }
function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' })[c]); }
function sanitizeKey(k){ return String(k||'').replace(/[^a-zA-Z0-9_-]/g,'').trim(); }
function requireKey(){ const k = sanitizeKey(GOMEGA_API_KEY_RAW); if(!k) throw new Error('Missing API key in CONFIG.'); return k; }
function backingFor(name){ return GOMEGA_BACKING[name] || GOMEGA_BACKING['gomega-v2']; }
function showSolvedBanner(show){ solvedBanner.style.display = show ? 'block' : 'none'; }

/* ---------- File helpers ---------- */
async function blobToBase64(blob){
  return new Promise((resolve,reject)=>{
    const r = new FileReader();
    r.onload = () => resolve((r.result||'').toString().split(',').pop());
    r.onerror = reject; r.readAsDataURL(blob);
  });
}
async function pdfPagesToImages(blob, maxPages=2){
  const out = [];
  const arr = await blob.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data:arr}).promise;
  const pages = Math.min(maxPages, pdf.numPages);
  for(let i=1;i<=pages;i++){
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({scale:2.0});
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = viewport.width; canvas.height = viewport.height;
    await page.render({canvasContext:ctx, viewport}).promise;
    out.push({ mime:'image/jpeg', base64: canvas.toDataURL('image/jpeg',0.9).split(',')[1] });
  }
  return out;
}
async function extractTextFromPDF(blob){
  const arr = await blob.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data:arr}).promise;
  let text=''; for(let p=1;p<=pdf.numPages;p++){ const pg=await pdf.getPage(p); const t=await pg.getTextContent({normalizeWhitespace:true}); text+=t.items.map(i=>i.str).join(' ')+'\n\n'; }
  return text.trim();
}
async function extractTextFromDOCX(arrayBuffer){
  const res = await mammoth.extractRawText({arrayBuffer});
  return (res.value||'').trim();
}

/* ---------- OpenAI call (behind Gomega Intellagence) ---------- */
async function gomegaAsk({modelName, text, images=[], wantPdf=false, style='concise'}){
  const key = requireKey();
  const model = backingFor(modelName).model;
  const parts = [];
  if(text) parts.push({type:'text', text});
  for(const img of images){ parts.push({type:'image_url', image_url:{url:`data:${img.mime};base64,${img.base64}`}}); }

  const sys = [
    "You are Gomega Intellagence (BETA). Read the provided content (text and/or images).",
    "Return strict JSON: {\"answers\":[{\"number\":string,\"question\"?:string,\"answer\":string,\"steps\"?:string}],\"pdf_b64\"?:string}.",
    "If asked to make a PDF, return base64 of a clean answer sheet in pdf_b64 (no data URL).",
    style==='full' ? "Include steps." : "Be concise; steps optional."
  ].join(' ');

  const body = {
    model,
    temperature: style==='full' ? 0.5 : 0.2,
    response_format: { type: "json_object" },
    messages: [
      { role:'system', content: sys },
      { role:'user', content: parts.concat(wantPdf ? [{type:'text', text:"Create an answered PDF titled 'Gomega Intellagence — Answer Sheet (BETA)'. Return base64 in pdf_b64 (no data URL)."}] : []) }
    ],
    max_tokens: 2000
  };

  const t0 = performance.now();
  const res = await fetch('https://api.openai.com/v1/chat/completions', {
    method:'POST',
    headers:{ 'Content-Type':'application/json', 'Authorization':`Bearer ${key}` },
    body: JSON.stringify(body)
  });
  const t1 = performance.now();

  if(!res.ok){
    const txt = await res.text().catch(()=>res.statusText);
    throw new Error('Gomega Intellagence backend error: ' + txt);
  }
  const json = await res.json();
  const usage = json.usage || {};
  tokenStat.textContent = usage.total_tokens ? `~${usage.total_tokens} tokens` : `~${Math.round((t1-t0)/1000)}s`;

  let content = json?.choices?.[0]?.message?.content || '{}';
  try{ return JSON.parse(content); }
  catch{ return { answers:[{number:"1", answer:content}] }; }
}

/* ---------- SAFE base64 -> Blob (fixes atob error) ---------- */
function normalizeB64(input){
  let b64 = String(input||'').trim();
  // strip data URL if present
  b64 = b64.replace(/^data:application\/pdf;base64,/i,'');
  // remove whitespace & newlines
  b64 = b64.replace(/\s+/g,'');
  // convert URL-safe base64 to standard
  b64 = b64.replace(/-/g,'+').replace(/_/g,'/');
  // pad to multiple of 4
  const pad = b64.length % 4;
  if(pad) b64 += '='.repeat(4 - pad);
  return b64;
}
function b64ToBlobSafe(b64, mime='application/pdf'){
  const clean = normalizeB64(b64);
  // decode in chunks to avoid overflow on big PDFs
  const sliceSize = 8192;
  const byteChars = atob(clean);
  const bytes = new Uint8Array(byteChars.length);
  for(let offset=0; offset<byteChars.length; offset+=sliceSize){
    const slice = byteChars.slice(offset, offset + sliceSize);
    for(let i=0; i<slice.length; i++) bytes[offset+i] = slice.charCodeAt(i);
  }
  return new Blob([bytes], {type:mime});
}

/* ---------- Pipeline ---------- */
let lastRun = null;

async function processFile(file){
  setStatus('sending to Gomega Intellagence'); setProgress(10);
  solutionEl.innerHTML=''; pdfOut.innerHTML=''; extractedEl.textContent=''; showSolvedBanner(false);

  let text=''; let images=[];
  if(file.type.startsWith('image/')){
    const b64 = await blobToBase64(file);
    images = [{mime:file.type, base64:b64}];
    extractedEl.textContent = '[Image sent to Vision]';
  } else if (/\.pdf$/i.test(file.name||'') || file.type==='application/pdf'){
    text = await extractTextFromPDF(file);
    if(!text || text.length < 20){
      images = await pdfPagesToImages(file, 2);
      extractedEl.textContent='[Scanned PDF pages sent to Vision]';
    } else {
      extractedEl.textContent = text;
    }
  } else if (/\.docx$/i.test(file.name||'')){
    text = await extractTextFromDOCX(await file.arrayBuffer());
    extractedEl.textContent = text;
  } else {
    text = await file.text().catch(()=> ''); extractedEl.textContent = text;
  }

  const wantPdf = (modeSel.value === 'fillpdf');
  const modelName = images.length ? 'gomega-vision' : modelSel.value;
  const style = styleSel.value;

  setStatus('solving'); setProgress(65);
  const ai = await gomegaAsk({ modelName, text, images, wantPdf, style });

  const answers = Array.isArray(ai.answers) ? ai.answers : [];
  const html = answers.map((a,i)=>`
    <div style="padding:10px;border:1px solid rgba(255,255,255,.06);border-radius:10px;margin-bottom:10px">
      ${a.question ? `<div style="color:#9cc5ff;margin-bottom:4px"><strong>Q${a.number||i+1}.</strong> ${escapeHtml(a.question)}</div>` : ''}
      <div><strong>Answer:</strong> ${escapeHtml(a.answer||'')}</div>
      ${a.steps ? `<details style="margin-top:6px"><summary>Steps (BETA)</summary><pre style="white-space:pre-wrap">${escapeHtml(a.steps)}</pre></details>`:''}
    </div>
  `).join('') || `<pre>${escapeHtml(JSON.stringify(ai,null,2))}</pre>`;
  solutionEl.innerHTML = html;

  pdfOut.innerHTML = '';
  if(ai.pdf_b64){
    try{
      const blob = b64ToBlobSafe(ai.pdf_b64, 'application/pdf');
      const url = URL.createObjectURL(blob);
      pdfOut.innerHTML = `<a class="pill" href="${url}" download="answers.pdf">Download answered PDF (Gomega Intellagence)</a>`;
    }catch(err){
      pdfOut.innerHTML = `<div style="color:#ff9b9b">Could not build PDF: ${escapeHtml(err.message)}</div>`;
    }
  }

  setStatus('done'); setProgress(100); showSolvedBanner(true);
  pushHistory({ model:modelName, when:new Date().toISOString(), answers });
  lastRun = { file };
}

/* ---------- History ---------- */
function pushHistory(entry){
  const key='gomega-history-v1';
  const list = JSON.parse(localStorage.getItem(key)||'[]');
  list.unshift(entry); localStorage.setItem(key, JSON.stringify(list.slice(0,20)));
  renderHistory(list);
}
function renderHistory(list){
  const h = (list||[]).map(it=>`
    <div class="item">
      <div class="small muted">${new Date(it.when).toLocaleString()} • ${it.model}</div>
      <div class="small" style="margin-top:6px">${escapeHtml((it.answers?.[0]?.answer||'').slice(0,140))}...</div>
    </div>`).join('');
  historyEl.innerHTML = h;
}
renderHistory(JSON.parse(localStorage.getItem('gomega-history-v1')||'[]'));

/* ---------- Buttons ---------- */
btnProcess.addEventListener('click', async ()=>{
  const f = filein.files?.[0]; if(!f) return alert('Choose a file first.');
  try{ await processFile(f); }
  catch(e){ setStatus('error'); setProgress(0); solutionEl.innerHTML = `<div style="color:#ff9b9b">Error: ${escapeHtml(e.message||e)}</div>`; }
});
btnRetry.addEventListener('click', async ()=>{
  if(!lastRun?.file) return alert('Nothing to retry.');
  try{ await processFile(lastRun.file); }
  catch(e){ setStatus('error'); setProgress(0); solutionEl.innerHTML = `<div style="color:#ff9b9b">Error: ${escapeHtml(e.message||e)}</div>`; }
});
btnClear.addEventListener('click', ()=>{
  filein.value=''; extractedEl.textContent=''; solutionEl.innerHTML=''; pdfOut.innerHTML='';
  setStatus('idle'); setProgress(0); showSolvedBanner(false);
});
document.getElementById('btnSwitchModel').addEventListener('click', async ()=>{
  if(!lastRun?.file) return alert('Run something first.');
  const opts=[...modelSel.options].map(o=>o.value);
  const i=(opts.indexOf(modelSel.value)+1)%opts.length; modelSel.value=opts[i];
  await processFile(lastRun.file);
});
document.getElementById('btnCopy').addEventListener('click', ()=>{
  const t = solutionEl.innerText.trim(); if(!t) return alert('Nothing to copy.');
  navigator.clipboard.writeText(t).then(()=>alert('Copied!')).catch(()=>alert('Copy failed'));
});
document.getElementById('btnDownloadTxt').addEventListener('click', ()=>{
  const t = solutionEl.innerText.trim(); if(!t) return alert('Nothing to download.');
  const blob = new Blob([t], {type:'text/plain'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='answers.txt'; a.click(); URL.revokeObjectURL(url);
});

/* Drag & drop */
const dropzone = document.getElementById('dropzone');
dropzone.addEventListener('dragover', e=>{ e.preventDefault(); dropzone.classList.add('drag');});
dropzone.addEventListener('dragleave', ()=> dropzone.classList.remove('drag'));
dropzone.addEventListener('drop', e=>{ e.preventDefault(); dropzone.classList.remove('drag'); if(e.dataTransfer.files?.[0]) filein.files = e.dataTransfer.files;});

/* Counters (kept for UI) */
const MAX_USES_PER_DAY = 5; const KEY_COUNTS = 'hw-helper-counts-v1';
function todayKey(){ return new Date().toISOString().slice(0,10); }
function loadCounts(){ const raw=JSON.parse(localStorage.getItem(KEY_COUNTS)||'{}'); if(raw.date!==todayKey()){Object.assign(raw,{date:todayKey(),solveSmarter:0,lookDeeper:0});} localStorage.setItem(KEY_COUNTS,JSON.stringify(raw)); return raw;}
function updatePill(){ const c=loadCounts(); document.getElementById('counterPill').textContent=`SS: ${Math.max(0,MAX_USES_PER_DAY-(c.solveSmarter||0))} • LD: ${Math.max(0,MAX_USES_PER_DAY-(c.lookDeeper||0))}`;}
updatePill(); setProgress(0); setStatus('idle');
</script>
</body>
</html>

